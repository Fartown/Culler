## 问题定位
- 快捷键集中定义在应用级菜单命令中：[CullerApp.swift](file:///Users/bytedance/workspace/ai-demo/culler/Culler/Culler/CullerApp.swift#L28-L33)，包含导入（Shift+Cmd+I）与照片标记/评分（P、X、U、数字 0–5）。
- 导入快捷键通过通知驱动弹窗：[ImportCommands](file:///Users/bytedance/workspace/ai-demo/culler/Culler/Culler/CullerApp.swift#L36-L45) → [ContentView.onReceive(importPhotos)](file:///Users/bytedance/workspace/ai-demo/culler/Culler/Culler/Views/ContentView.swift#L135-L137)。
- 标记/评分快捷键通过通知驱动选中照片更新：[PhotoCommands](file:///Users/bytedance/workspace/ai-demo/culler/Culler/Culler/CullerApp.swift#L47-L80) → [ContentView.onReceive(setFlag / setRating)](file:///Users/bytedance/workspace/ai-demo/culler/Culler/Culler/Views/ContentView.swift#L138-L147)。
- 现象与原因：
  - 使用未带修饰键的字母/数字快捷键（如 P、X、U、1–5、0）在 macOS 中不稳定，常被当前焦点视图吞掉；SwiftUI 菜单命令并不会像 Lightroom 那样全局拦截按键。
  - setFlagForSelected / setRatingForSelected 仅作用于 selectedPhotos，当在单图/全屏模式下未显式选中照片时，快捷键看起来“无效”。

## 修改方案
- 保留现有菜单项与 Shift+Cmd+I（导入）不变。
- 为 Lightroom 风格无修饰键的快捷键新增可靠的键盘事件监听：在应用激活时通过 NSEvent.addLocalMonitorForEvents(matching: .keyDown) 统一拦截按键，并映射到现有通知（importPhotos 除外）。
  - 键位映射：
    - 'p' → .setFlag(Flag.pick)
    - 'x' → .setFlag(Flag.reject)
    - 'u' → .setFlag(Flag.none)
    - '1'...'5' → .setRating(Int)
    - '0' → .setRating(0)
  - 保护条件：若第一响应者是 NSTextField/NSTextView 等文本输入控件则不拦截；若导入弹窗/其他模态显示则暂停。
- 优化通知处理：当 selectedPhotos 为空且存在 currentPhoto 时，对 currentPhoto 生效，避免单图/全屏模式下“无响应”。

## 实施步骤
1. 新增 KeyboardShortcutManager（单例）：封装 addLocalMonitor/removeMonitor、键位解析、保护条件判断。
2. 在应用窗口出现时初始化与释放监听：可在 [ContentView](file:///Users/bytedance/workspace/ai-demo/culler/Culler/Culler/Views/ContentView.swift#L46-L148) 通过 .onAppear/.onDisappear 管理生命周期，或在 App 层统一管理。
3. 保持 [CullerApp.swift](file:///Users/bytedance/workspace/ai-demo/culler/Culler/Culler/CullerApp.swift#L36-L80) 中 Commands 现有行为（用于菜单与组合键）。
4. 优化 ContentView 的处理函数：
   - setFlagForSelected：若 selectedPhotos 为空且 currentPhoto 存在，则直接更新 currentPhoto。
   - setRatingForSelected：逻辑同上。

## 验证方案
- Grid 视图：选中 1 张或多张照片，按 P/X/U、数字 1–5/0，观察标记与评分即时变化；Shift+Cmd+I 打开导入面板。
- Single/Fullscreen 视图：未选择但已有 currentPhoto，按上述快捷键仍应生效。
- 文本输入场景：在有文本框焦点时，按 P/X/U/数字不应触发快捷键（验证保护条件）。

## 兼容性与风险
- 避免与系统常用组合键冲突（如 Cmd-X/Cmd-P 等），因此继续采用无修饰键并通过本地监控实现；菜单项保留用于可发现性与辅助操作。
- 监听器只在应用激活且非文本输入时工作，较低风险；如后续出现冲突，可增加更细致的焦点判断。

## 需要您确认
- 是否采用 Lightroom 风格的无修饰键（P/X/U、数字）作为快捷键？若希望改为组合键（Cmd/Shift/Option），我将改为统一的组合键方案并清理事件监听。