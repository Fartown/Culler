## 目标
- 当导入的文件夹包含多个子文件夹时，提供树形展开浏览，点击子文件夹即可切换到该文件夹并在网格中预览其照片。
- 保持现有缩略图加载与预览逻辑不变，仅扩展文件夹导航体验。

## 现状与切入点
- 已有按父目录路径的平铺分组视图 [ImportManagementView](file:///Users/bytedance/workspace/ai-demo/culler/Culler/Culler/Views/ImportView.swift#L292-L417)，不支持层级浏览。
- 过滤逻辑在 [ContentView.filteredPhotos](file:///Users/bytedance/workspace/ai-demo/culler/Culler/Culler/Views/ContentView.swift#L26-L45) 通过 filterFolder 精确匹配父目录路径。
- 缩略图与大图加载复用 [ThumbnailService](file:///Users/bytedance/workspace/ai-demo/culler/Culler/Culler/Services/ThumbnailService.swift)。

## 功能设计
- 新增“文件夹树视图”：按路径层级构建树，显示文件夹名、完整路径和该节点照片数量。
- 交互：
  - 单击节点：设置选中节点为当前文件夹，切换 ContentView 到 Grid，展示该文件夹的照片。
  - 右键菜单：查看照片、在 Finder 打开、从库中移除（递归删除该节点及子节点内的 Photo）。
  - 可选开关：“包含子文件夹”——选择父文件夹时是否包含所有子目录的照片。

## 技术实现
### 1) 构建层级数据（新增模型）
- 新增 FolderNode 结构：`id`、`name`、`fullPath`、`children: [FolderNode]`、`count`、`photos: [Photo]`。
- 从 `@Query photos` 中按每张照片的 `URL(filePath).deletingLastPathComponent()` 逐级拆分 `pathComponents`，构建树形结构。
- 为性能，缓存构建结果，监听 `photos` 变化时重建。

### 2) 树视图组件
- 新增 FoldersTreeView（SwiftUI）：使用 `OutlineGroup(data:children:)` 或 `DisclosureGroup` + `List` 实现展开/折叠。
- 显示：文件夹图标、`name`、`count`，悬浮显示 `fullPath`；提供上下文菜单。
- 选择节点后触发回调：`onSelect(fullPath)`。

### 3) 集成到管理视图
- 修改 [ImportManagementView](file:///Users/bytedance/workspace/ai-demo/culler/Culler/Culler/Views/ImportView.swift#L292-L417)：
  - 用新 FoldersTreeView 替换现有平铺 `List`。
  - 绑定 `filterFolder` 与 `viewMode`，在选择节点时：`filterFolder = node.fullPath; viewMode = .grid`。
  - 删除动作递归遍历该节点的 `photos`（含子节点）并执行 `modelContext.delete(photo)`。

### 4) 扩展过滤逻辑（可选“包含子文件夹”）
- 在 [ContentView](file:///Users/bytedance/workspace/ai-demo/culler/Culler/Culler/Views/ContentView.swift) 增加 `@State includeSubfolders: Bool`。
- 更新 `filteredPhotos`：当启用包含子文件夹时，改为路径前缀匹配（注意边界，如以 `/` 分隔避免误匹配）。例如：
  - `photoDir == folder`（仅本文件夹）或
  - `photoDir.hasPrefix(folderWithTrailingSlash)`（包含子文件夹）。
- 在 `.folderManagement` 视图区域添加一个 Toggle 控件控制此行为。

## 文件改动列表
- 新增：`Culler/Culler/Models/FolderNode.swift`（构建与工具函数）。
- 新增：`Culler/Culler/Views/FoldersTreeView.swift`（树形 UI）。
- 更新：`Culler/Culler/Views/ImportView.swift`（ImportManagementView 改为树形视图与递归删除）。
- 更新：`Culler/Culler/Views/ContentView.swift`（添加 includeSubfolders 状态与过滤逻辑、在 folderManagement 区域增加 Toggle）。

## 边界与注意事项
- 路径标准化：使用 `URL(fileURLWithPath:).standardizedFileURL` 构建与比较，避免符号链接与大小写问题。
- 前缀匹配边界：统一为 `folderPathWithSlash = folder.hasSuffix("/") ? folder : folder + "/"`；匹配时用 `photoDir == folder || photoDir.hasPrefix(folderPathWithSlash)`。
- 大型层级性能：节点多时使用 `List`/`OutlineGroup` 的懒加载；必要时做“仅显示近期导入根”的过滤（后续优化）。
- 权限：Finder 打开仍用 `NSWorkspace.shared.selectFile(nil, inFileViewerRootedAtPath: folder)`。

## 测试计划
- 在 [CullerUITests](file:///Users/bytedance/workspace/ai-demo/culler/Culler/CullerUITests/CullerUITests.swift) 添加：
  - `testFolderTreeNavigation`：导入包含多级子目录的数据，展开树，选择子文件夹后 Grid 显示该子文件夹照片数量与内容。
  - `testIncludeSubfoldersToggle`：选择父文件夹，切换 Toggle，验证照片集是否包含/排除子目录照片。
  - `testRecursiveDeleteOnNode`：在节点上执行“从库中移除”，确认该节点及子节点内照片均被删除。

## 交付与兼容
- 兼容现有导入逻辑与缩略图服务，无需改动。
- UI 风格遵循现有 Sidebar/ContentView 视觉，保持一致的图标与颜色处理。

如确认该计划，我将按以上文件改动与测试用例逐步实现并验证。