# Culler UI 交互优化方案（v2）

本文基于当前实现（`Culler/Culler/Views/*`、`Culler/Culler/Services/KeyboardShortcutManager.swift`）的结构与交互逻辑，提出一套更**友好、直接、简单**的 UI/交互优化方案；目标是降低学习成本、提高选片效率，并保持 macOS 原生一致性。

---

## 0. UI 问题评审报告（基于截图）

### 0.1 范围与前提
- 范围：左侧导航栏 + 中央缩略图网格 + 右侧详情面板 + 顶部状态/排序区 + 底部标注工具条（截图可见部分）。
- 前提：仅依据截图进行评审，不推断隐藏交互与业务规则；以可理解性、效率、一致性、可访问性为主要评判标准。

### 0.2 结论摘要
- 界面信息量大但主流程不突出，用户进入后“下一步做什么”不够清晰。
- 状态与操作联动弱，选中后可执行动作与作用范围不直观。
- 中英文与控件体系不一致，增加认知成本。
- 可读性与可访问性存在风险：灰字过多、对比偏低、小图标命中区域偏小。

### 0.3 问题清单与改进方案

#### A. 信息架构与布局
- 问题：缺少清晰的主线操作路径（浏览→筛选→选择→标注→导出/同步），选中后动作入口不聚合。
  - 方案：引入“选中态上下文工具条”，固定展示已选数量、核心动作（接受/拒绝/评分/颜色/标签/导出/删除）、撤销/重做，并明确“将应用于 N 张”。
- 问题：右侧详情面板信息过密且层级弱，可编辑与只读信息混在同一视觉层。
  - 方案：分组为“概览/可编辑/高级元数据”，可编辑项使用一致表单控件样式，EXIF 等默认折叠。
- 问题：左侧栏视图、文件夹、标签/筛选同权重呈现，导航与过滤混杂。
  - 方案：左栏三段式：视图（全部/已选/已拒/未标注…）+ 数据源（文件夹树）+ 过滤器（标签、评分、颜色、媒体类型等）。

#### B. 一致性（语言、术语、控件）
- 问题：中英文混用（如 CULLER、Flag/Rating/Clear/Color 与中文字段并存）。
  - 方案：确定语言策略并统一术语；至少将核心操作与状态统一为中文，并在设置中处理“英文括注”。
- 问题：控件尺寸、图标风格、对齐规则不一致，降低整体质量感。
  - 方案：建立控件与图标规范（尺寸、间距、hover/focus、禁用态），关键操作统一按钮样式。

#### C. 可读性与视觉层级
- 问题：深色主题下灰字较多、字号偏小，右侧元信息密集导致扫描成本高。
  - 方案：提升关键文本对比与字号层级；右侧采用“主信息优先”的排版（文件名、拍摄时间、分辨率/大小）。
- 问题：缩略图网格缺少状态角标，必须依赖右侧面板确认状态。
  - 方案：为缩略图增加角标：视频时长、已选/已拒、评分、颜色（可配置开关避免过载）。

#### D. 可用性与可发现性
- 问题：“包含子文件夹”开关缺少明确上下文，作用范围不清。
  - 方案：将开关紧贴“文件夹”分组，并用简短文案说明其影响范围。
- 问题：缺少显性搜索与组合过滤入口（仅靠排序不足）。
  - 方案：顶部增加搜索框（文件名/标签/元数据），并提供可组合过滤（评分范围、旗标、颜色、媒体类型、日期范围）。
- 问题：底部工具条语义不自解释（尤其 Clear、颜色点），作用范围不明确。
  - 方案：将 Clear 拆分为明确动作（清除评分/清除颜色/清除标记或清除筛选）；为颜色与评分提供 tooltip 与快捷键提示。

#### E. 状态反馈与联动
- 问题：已选数量可见，但缺少“当前选中对象”的持续定位与导航入口。
  - 方案：顶部固定显示当前选中项文件名/序号，提供上一张/下一张（快捷键）并与右侧详情同步。
- 问题：多选时标注是否对全部生效不明确。
  - 方案：在工具条中明确显示“将应用于 N 张”，并在缩略图角标即时反馈。

#### F. 可访问性
- 问题：小图标命中区域偏小，颜色标记对色弱不友好。
  - 方案：提升命中区域（建议 ≥32×32 或更高），提供 hover/focus 与键盘可达性；颜色同时配合文字/纹理。

### 0.4 优先级与落地节奏
- P0：统一术语与语言；选中态上下文工具条；右侧信息分组与可编辑项样式；缩略图最小角标（已选/已拒/媒体类型）。
- P1：搜索与组合过滤；左栏三段式重构；批量操作的范围提示与撤销/重做。
- P2：对比度与字号体系；命中区域规范；色弱友好模式。

### 0.5 验收标准
- 进入页面 3 秒内可判断：当前范围、是否有筛选、已选数量、下一步可执行的主要操作。
- 单选/多选时工具条明确提示作用范围（1 张/N 张），并在缩略图上即时反映状态。
- 右侧面板“可编辑 vs 只读”明显区分，分组层级清晰。
- 在 300+ 素材中可通过搜索与过滤快速定位目标。

## 1. 设计目标与原则

### 目标
- 让用户在「导入 → 浏览 → 标记 → 筛选 → 导出/清理」链路里，**无需切换太多模式**即可完成任务。
- 主流程「浏览/标记/筛选」始终可达；进阶能力（同步、删除、管理标签/相册）不打断当前工作流。
- 关键状态（当前范围、筛选条件、排序、选中数量）始终可见且可一键清除。

### 原则
- **少模式**：减少 `viewMode` 分支带来的心理负担，尽量用同一页面状态完成不同任务。
- **就地操作**：筛选、标记、信息查看在当前上下文内完成，不用跳转到“管理页”。
- **原生一致**：遵循 macOS 三栏/检查器（Inspector）范式：侧边栏（Source List）+ 内容区 + 右侧检查器。
- **快捷优先**：重度用户全键盘完成，轻度用户鼠标/触控板也能直观上手。

---

## 2. 当前交互梳理（基于代码）

### 当前布局与模式
- 左侧 `SidebarView`：入口（All Photos / Folders / Picked / Rejected）、评分筛选、颜色筛选、相册列表（但相册管理页入口缺失）。
- 中间 `FoldersTreeView`：仅在 `viewMode == .folderBrowser` 时显示/可交互（通过 `opacity + allowsHitTesting` 控制）。
- 主区 `ToolbarView` + `PhotoGridView` / `SinglePhotoView` / `FullscreenView` / `ImportManagementView` / `FolderPreviewView`。
- 右侧 `InfoPanelView`：选中照片信息（仅在非全屏且有当前照片时出现，可隐藏/恢复）。
- 底部 `MarkingToolbar`：在非全屏时**始终出现**，无论是否选择照片。

### 当前快捷键
（`KeyboardShortcutManager` + menu commands）
- 标记：`P`（Pick），`X`（Reject），`U`（Unflag），`1~5`（评分），`0`（清分）。
- 导航：方向键（在网格/单图/全屏均可）。
- 选择：`⌘A` 全选。
- 缩放：`⌘+ / ⌘- / ⌘0`，`⌘` + 滚轮缩放。
- 命令：`⌘⇧I` 导入，`⌘⇧F` Folder Browser。

---

## 3. 主要痛点（影响“友好、直接、简单”）

1. **Folder Browser 是一个“模式”**：文件夹树只有在进入模式后才可用；用户很难理解“为什么文件夹树有时在、有时不在”。  
2. **筛选入口分散且占侧栏空间**：评分/颜色放在左侧栏，会把导航与筛选混在一起，侧栏变得“很长、很杂”。  
3. **底部标记栏常驻占位**：无选择时仍占据高度，信息密度下降；对新用户也不清楚“下一步该做什么”。  
4. **相册/标签能力存在但入口弱**：`AlbumManagementView` 有实现，但在主流程中不可发现；相册在侧栏展示却不可点击进入或应用筛选。  
5. **文案中英混用**：例如 Sidebar/InfoPanel/Import 等处中英文混杂，会增加认知成本。  

---

## 4. 新的信息架构（推荐）

采用标准三栏范式：**左侧 Source List（导航） + 中间 Browser（浏览） + 右侧 Inspector（信息/筛选）**。  
核心变化：**“文件夹”不再是模式，而是侧边栏中的一种范围（Scope）**。

### 4.1 左侧：Source List（导航/范围）
分组建议：
- **图库**
  - 全部照片（All）
  - 已选（Picked）
  - 已拒（Rejected）
- **文件夹**
  - 文件夹树（可折叠）
  - 「包含子文件夹」开关（紧贴文件夹分组标题右侧的小开关）
- **相册**
  - 相册列表（可选中后作为范围过滤）
  - “管理相册与标签…”（入口明确）

交互规则：
- 用户点击任一条目，等价于设置一个“范围过滤器”：`Scope = All / Flag / Folder / Album`。
- 侧边栏只负责“去哪儿”，不负责细粒度筛选（评分/颜色/相机等移到 Inspector）。

### 4.2 中间：Browser（浏览）
默认始终是网格（Grid），单图（Detail）只是“当前选中照片的放大查看”，不需要让用户理解“模式切换”：
- 网格：浏览/多选/快速标记。
- 单图：查看细节、缩放/平移、快速切换上一张/下一张。
- 全屏：无干扰审片。

建议：将“Grid / Single / Fullscreen”视为**同一条浏览链路的不同展示**，在交互上保持一致（同一套快捷键/同一套标记行为）。

### 4.3 右侧：Inspector（信息 + 筛选）
Inspector 默认显示：
- **信息**：当前照片信息（保持现有 `InfoPanelView` 能力）。
- **筛选**：统一放到一个可折叠区域（评分、旗标、颜色、标签、相机/镜头、时间）。

Inspector 的目标是“随时打开/关闭”，不会打断浏览；顶部工具栏提供 Inspector toggle（类似 Finder 的检查器按钮）。

---

## 5. 新的核心交互（更直接）

### 5.1 导入（Import）
目标：导入后用户立即进入可浏览状态，并“知道自己导入到了哪里”。
- 入口：`⌘⇧I`、侧栏固定“导入”按钮、空状态主按钮。
- 流程建议：
  1) 选择文件/文件夹（拖拽或浏览）  
  2) 选择导入模式（引用/拷贝）+ 去重说明（仅做路径去重也要明确文案）  
  3) 导入完成后：自动将 Scope 切到“刚导入的文件夹/批次”，并显示结果摘要（成功/跳过/失败）。

### 5.2 浏览（Browse）
- 网格单击：选中（支持 `Shift`/`⌘` 多选，保持系统习惯）。
- 空格（建议新增）：Quick Look 预览（macOS 习惯）。  
- 双击/回车：进入单图查看（Detail）。
- 单图：左右键切换，双击缩放，滚轮/触控板缩放（保留现有）。
- 全屏：`F` 或 `⌃⌘F`（建议与系统一致），Esc 退出（保留现有）。

### 5.3 标记（Mark）
标记动作对新手要“显而易见”，对老手要“极快”：
- 保留：`P / X / U / 1~5 / 0`。
- 网格 hover 快捷按钮保留，但建议变为更“安全”的默认：  
  - 星：快速置顶（例如切 5 星/清除）可以保留  
  - Pick/Reject：建议对多选生效（当前右键菜单已支持多选目标）
- **标记工具条（MarkingToolbar）改为“上下文出现”**：
  - 无选中：不显示或以很低存在感展示一个 1 行提示（例如“选中照片后可快速标记，快捷键 P/X/1-5”）。
  - 有选中：显示完整标记工具条。

### 5.4 筛选（Filter）
把筛选从“侧栏长列表”变成“可视化、可清除的条件集合”：
- 筛选入口：工具栏的“筛选”按钮（打开 Inspector 的 Filter 区域）。
- 在工具栏显示“筛选条件 Chips”（例如：`≥3★`、`Pick`、`Red`、`包含子文件夹`），每个 chip 可单独清除。
- 一键清除：工具栏提供“清除筛选”按钮（只清筛选，不改变 Scope）。

### 5.5 文件夹（Folders）
把文件夹从“模式”改成“范围”：
- 文件夹树始终可见（在左侧 Source List 的“文件夹”分组内）。
- 点击文件夹：Scope = Folder，并在工具栏显示面包屑/路径尾部。
- 同步（Sync）：如果当前 Scope 是某个文件夹，工具栏提供一个明确的“同步此文件夹”按钮；不需要在右键里“猜”。  
- 删除能力分层：
  - “从库移除”（非破坏性）默认放在首位。
  - “从磁盘删除”必须二次确认，并在文案中明确范围（单文件 / RAW+JPG）。

### 5.6 相册与标签（Albums/Tags）
让相册成为“第二种组织方式”而不是孤立管理页：
- 左侧相册可点选：Scope = Album。
- 对选中照片提供：
  - “加入相册…”（支持最近相册）
  - “添加标签…”（支持搜索/创建）
- “管理相册与标签…”作为入口保留，用于维护结构/颜色等。

---

## 6. 工具栏（Toolbar）建议改版

现有 `ToolbarView` 只包含视图切换 + 排序；建议增强为“主控条”，但保持简洁：
- 左侧：Sidebar toggle（系统图标）、视图切换（Grid/Detail/Fullscreen）。
- 中部：当前范围摘要（例如 `文件夹：2026/01/03` 或 `相册：婚礼`）+ 筛选 chips。
- 右侧：排序、筛选（打开 Inspector）、搜索（可选，MVP 可先不做）。

工具栏信息密度的目标是：用户不用看侧栏，也知道“我现在在看什么、我筛了什么、我选了多少”。

---

## 7. 文案与一致性（建议统一中文）

当前存在中英混用，建议统一中文并保持短词：
- Import → 导入
- Library → 图库
- All Photos → 全部照片
- Picked / Rejected → 已选 / 已拒
- Sort → 排序
- Show in Finder → 在 Finder 中显示
- Delete from Disk → 从磁盘删除

---

## 8. 与现有代码的落地映射（最小改动优先）

下面给的是“如何从当前实现演进到新方案”的最小改动路径，避免大重构：

1. **取消 `.folderBrowser` 模式**  
   - `ContentView.ViewMode` 收敛为：`.grid / .single / .fullscreen`。  
   - `FoldersTreeView` 移到 `SidebarView` 内（“文件夹”分组），或改为左侧第二栏而不是“只在某模式出现”。

2. **筛选面板从 `SidebarView` 移到 Inspector**  
   - 抽一个 `FilterPanelView`，承载 `filterRating/filterFlag/filterColorLabel` 等绑定。  
   - 工具栏增加筛选按钮，控制右侧 Inspector 展示筛选区（或弹出 popover）。

3. **`MarkingToolbar` 改为上下文展示**  
   - 条件：`selectedPhotos` 非空 或 `viewMode != .grid`。  
   - 无选中时显示 `EmptyStateView` 风格的轻提示（可选）。

4. **补齐入口**  
   - 在侧栏“相册”分组末尾加“管理相册与标签…”按钮，打开 `AlbumManagementView`。  
   - `ImportManagementView` 如需保留，可作为“导入来源/文件夹管理”的二级入口（不要占用主导航）。

---

## 9. 预期收益（对用户可感知）
- 用户不再需要理解“Folder Browser 模式”，文件夹选择变为随时可用的范围切换。
- 侧栏更短更清晰：只做导航；筛选集中到 Inspector，且可视化 chips 一键清除。
- 标记操作更自然：选中才出现标记条，屏幕空间更有效。
- 相册/标签从“隐藏能力”变为“主流程可达”的组织方式。
